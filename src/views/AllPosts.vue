<template>
  <div>
    <p>NotebookID: {{this.$route.params.id}}</p>
    <p>UserID: {{this.uid}}</p>
    <Logout/>
    <MoodGraph id="mood-graph" 
               v-bind:dateRange="dateRange"
               v-bind:sentimentScores="sentimentScores"/>
    <AddNewPost v-on:new-post="handleNewPost" v-bind:tags="tags"></AddNewPost>
    <div class="all-posts">
      <Post v-for="(post,index) in posts" :key="index" v-bind:post-data="post"/>
    </div>
  </div>
</template>

<script>
import Post from "@/components/Post.vue";
import AddNewPost from "@/components/AddNewPost.vue";
import Logout from "@/components/Logout.vue";
import MoodGraph from "@/components/MoodGraph.vue";
import {HTTP} from '@/httpCommon'
import firebase from "firebase/app";
import "firebase/auth";

export default {
  name: "AllPosts",
  components: {
    Post,
    AddNewPost,
    Logout,
    MoodGraph
  },
  data() {
    return {
      uid: "",
      posts: [],
      tags: {},
      dateRange:["2018-07-05T00:00:00","2018-07-12T00:00:00","2018-07-13T00:00:00","2018-07-14T00:00:00","2018-07-15T00:00:00","2018-07-16T00:00:00","2018-07-17T00:00:00","2018-07-18T00:00:00","2018-07-19T00:00:00","2018-07-20T00:00:00","2018-07-21T00:00:00","2018-07-22T00:00:00","2018-07-23T00:00:00","2018-07-24T00:00:00","2018-07-25T00:00:00","2018-07-26T00:00:00","2018-07-27T00:00:00","2018-07-28T00:00:00","2018-07-29T00:00:00","2018-07-30T00:00:00","2018-07-31T00:00:00","2018-08-01T00:00:00","2018-08-02T00:00:00","2018-08-03T00:00:00","2018-08-04T00:00:00","2018-08-05T00:00:00","2018-08-06T00:00:00","2018-08-07T00:00:00","2018-08-08T00:00:00","2018-08-09T00:00:00","2018-08-10T00:00:00","2018-08-11T00:00:00","2018-08-13T00:00:00","2018-08-14T00:00:00","2018-08-19T00:00:00","2018-08-20T00:00:00","2018-08-22T00:00:00","2018-08-27T00:00:00","2018-08-28T00:00:00","2018-08-29T00:00:00","2018-08-30T00:00:00","2018-08-31T00:00:00","2018-08-31T00:00:00","2018-09-03T00:00:00","2018-09-04T00:00:00","2018-09-05T00:00:00","2018-09-06T00:00:00","2018-09-07T00:00:00","2018-09-08T00:00:00","2018-09-09T00:00:00","2018-09-10T00:00:00","2018-09-11T00:00:00","2018-09-12T00:00:00","2018-09-13T00:00:00","2018-09-14T00:00:00","2018-09-15T00:00:00","2018-09-16T00:00:00","2018-09-17T00:00:00","2018-09-18T00:00:00","2018-09-19T00:00:00","2018-09-20T00:00:00","2018-09-22T00:00:00","2018-09-23T00:00:00","2018-09-24T00:00:00","2018-09-25T00:00:00","2018-09-26T00:00:00","2018-09-28T00:00:00","2018-09-29T00:00:00","2018-09-30T00:00:00","2018-10-01T00:00:00","2018-10-05T00:00:00","2018-10-06T00:00:00","2018-10-07T00:00:00","2018-10-08T00:00:00","2018-10-10T00:00:00","2018-10-12T00:00:00","2018-10-13T00:00:00","2018-10-14T00:00:00","2018-10-15T00:00:00","2018-10-16T00:00:00","2018-10-17T00:00:00","2018-10-25T00:00:00","2018-10-29T00:00:00","2018-11-05T00:00:00","2018-11-06T00:00:00","2018-11-07T00:00:00","2018-11-08T00:00:00","2018-11-10T00:00:00","2018-11-11T00:00:00","2018-11-12T00:00:00","2018-11-13T00:00:00","2018-11-16T00:00:00","2018-11-17T00:00:00","2018-11-18T00:00:00","2018-11-19T00:00:00","2018-11-20T00:00:00","2018-11-25T00:00:00","2018-11-26T00:00:00","2018-11-29T00:00:00","2018-12-01T00:00:00","2018-12-02T00:00:00","2018-12-07T00:00:00","2018-12-08T00:00:00","2018-12-11T00:00:00","2018-12-14T00:00:00","2018-12-15T00:00:00","2018-12-17T00:00:00","2018-12-18T00:00:00","2018-12-20T00:00:00","2018-12-25T00:00:00","2018-12-28T00:00:00","2018-12-29T00:00:00","2018-12-30T00:00:00","2019-01-02T00:00:00","2019-01-04T00:00:00","2019-01-07T00:00:00","2019-01-10T00:00:00","2019-01-11T00:00:00","2019-01-12T00:00:00","2019-01-13T00:00:00","2019-01-14T00:00:00","2019-01-15T00:00:00","2019-01-16T00:00:00","2019-01-17T00:00:00","2019-01-19T00:00:00","2019-01-20T00:00:00","2019-01-21T00:00:00","2019-01-22T00:00:00","2019-01-23T00:00:00","2019-01-26T00:00:00","2019-01-27T00:00:00","2019-01-28T00:00:00","2019-01-29T00:00:00","2019-01-30T00:00:00","2019-01-31T00:00:00","2019-02-01T00:00:00","2019-02-02T00:00:00","2019-02-03T00:00:00","2019-02-05T00:00:00","2019-02-09T00:00:00","2019-02-11T00:00:00","2019-02-12T00:00:00","2019-02-13T00:00:00","2019-02-14T00:00:00","2019-02-15T00:00:00","2019-02-16T00:00:00","2019-02-17T00:00:00","2019-02-18T00:00:00","2019-02-19T00:00:00","2019-02-20T00:00:00","2019-02-21T00:00:00","2019-02-22T00:00:00","2019-02-23T00:00:00","2018-07-05T00:00:00","2019-03-01T00:00:00","2019-03-01T00:00:00","2019-03-01T00:00:00","2019-03-03T00:00:00","2019-03-03T00:00:00","2019-03-03T00:00:00","2019-03-03T00:00:00","2019-03-04T00:00:00","2019-03-05T00:00:00","2019-03-06T00:00:00","2019-03-07T00:00:00","2019-03-08T00:00:00","2019-03-09T00:00:00","2019-03-10T00:00:00","2019-03-11T00:00:00","2019-03-13T00:00:00","2019-03-14T00:00:00","2019-03-15T00:00:00","2019-03-15T00:00:00","2019-03-17T00:00:00","2019-03-18T00:00:00","2019-03-20T00:00:00","2019-03-21T00:00:00","2019-03-24T00:00:00","2019-03-26T00:00:00","2019-03-27T00:00:00","2019-04-05T00:00:00","2019-04-07T00:00:00","2019-04-08T00:00:00","2019-04-11T00:00:00","2019-04-11T00:00:00","2019-04-12T00:00:00","2019-04-14T00:00:00","2019-04-15T00:00:00","2019-04-16T00:00:00","2019-04-19T00:00:00","2019-04-21T00:00:00","2019-04-22T00:00:00","2019-04-25T00:00:00","2019-04-26T00:00:00","2019-04-26T00:00:00","2019-04-28T00:00:00","2019-04-28T00:00:00","2019-04-29T00:00:00","2019-04-30T00:00:00","2019-05-01T00:00:00","2019-05-02T00:00:00","2019-05-04T00:00:00","2019-05-06T00:00:00","2019-05-07T00:00:00","2019-05-10T00:00:00","2019-05-12T00:00:00","2019-05-13T00:00:00","2019-05-15T00:00:00","2019-05-16T00:00:00","2019-05-17T00:00:00","2019-05-19T00:00:00","2019-05-20T00:00:00","2019-05-20T00:00:00","2019-05-21T00:00:00","2019-05-21T00:00:00","2019-05-22T00:00:00","2019-05-25T00:00:00","2019-05-25T00:00:00","2019-05-26T00:00:00","2019-05-27T00:00:00","2019-05-28T00:00:00","2019-05-30T00:00:00","2019-05-31T00:00:00","2019-06-03T00:00:00","2019-06-06T00:00:00","2019-06-07T00:00:00","2019-06-08T00:00:00","2019-06-16T00:00:00","2019-06-16T00:00:00","2019-06-16T00:00:00","2019-06-16T00:00:00","2019-06-23T11:47:00"],
      sentimentScores:[-0.046875,0.25,0.11538461538461539,0.06493506493506493,0.08333333333333333,0.12244897959183673,0,0,0.1724137931034483,0.10227272727272728,0.1016949152542373,0.16071428571428573,-0.09740259740259741,0.0851063829787234,-0.16666666666666666,0.21311475409836064,0.2765957446808511,0.05970149253731343,0,0.047619047619047616,0.07446808510638298,-0.03125,0.10526315789473684,0,-0.2727272727272727,0,-0.02564102564102564,-0.005555555555555556,0.32075471698113206,0.21311475409836064,0.125,0.059322033898305086,0,0.09615384615384616,0.11864406779661017,0,0.023255813953488372,0,0.03125,0,0.007751937984496124,-0.018518518518518517,0.06896551724137931,0.049689440993788817,0.008032128514056224,0.12121212121212122,0,-0.041666666666666664,0.05555555555555555,0.029411764705882353,0.050359712230215826,-0.14285714285714285,0,-0.18604651162790697,0.008403361344537815,0.04504504504504504,0.05508474576271186,0.06481481481481481,-0.15789473684210525,-0.013333333333333334,-0.017543859649122806,0.010309278350515464,-0.12,-0.08695652173913043,-0.04477611940298507,-0.11764705882352941,0.08333333333333333,0.010101010101010102,0.03398058252427184,0.08823529411764706,0.009523809523809525,0.14457831325301204,0.056338028169014086,0.0594059405940594,0.04597701149425287,-0.009345794392523364,0.018518518518518517,0,0,-0.08695652173913043,0.014925373134328358,0.02654867256637168,0.030364372469635626,-0.0425531914893617,-0.1,0.005050505050505051,-0.037037037037037035,0,0.013888888888888888,0.14545454545454545,0.125,0.07407407407407407,0,0.14492753623188406,0.1388888888888889,-0.15625,-0.017241379310344827,0,0.012345679012345678,-0.05555555555555555,0.05714285714285714,0.06593406593406594,-0.07446808510638298,0.10869565217391304,0,0.061224489795918366,-0.06557377049180328,0,-0.015151515151515152,0.05755395683453238,0.23076923076923078,0,0.03571428571428571,0.07207207207207207,0.08695652173913043,-0.08333333333333333,0.057971014492753624,-0.07368421052631578,0.36363636363636365,0.046511627906976744,-0.14285714285714285,-0.1111111111111111,0.06557377049180328,0.0392156862745098,0.09523809523809523,0.03225806451612903,0.11363636363636363,-0.07894736842105263,0.0821917808219178,-0.009900990099009901,0.07894736842105263,0.11627906976744186,0.6666666666666666,-0.08333333333333333,-0.2857142857142857,-0.0625,0.15384615384615385,-0.1282051282051282,0,0.06557377049180328,0.1375,0.4117647058823529,0.1206896551724138,0.14285714285714285,0.19298245614035087,0.06666666666666667,-0.09615384615384616,0.23076923076923078,0.20634920634920634,0.08860759493670886,0.021739130434782608,0.061224489795918366,0,0,0,0,0,0,0.24,0.18518518518518517,0.18518518518518517,-0.038461538461538464,0.0975609756097561,0.07692307692307693,0.013513513513513514,0.010869565217391304,0,0.0891089108910891,0.13157894736842105,0.06097560975609756,0.13157894736842105,0,0,0.09523809523809523,0.08695652173913043,-0.15625,0.0625,0.1111111111111111,0.08333333333333333,0.021739130434782608,0.04310344827586207,-0.06896551724137931,0.015384615384615385,-0.047058823529411764,0.25,0.06060606060606061,0,0.0684931506849315,0.12096774193548387,0.18518518518518517,0.12195121951219512,-0.0375,-0.03529411764705882,0,0.07894736842105263,0.0379746835443038,0.024096385542168676,0.1267605633802817,0.08045977011494253,0.10144927536231885,0.1896551724137931,0.05555555555555555,0.06060606060606061,0.02,0.019801980198019802,0.1232876712328767,0,-0.03529411764705882,0.08,0,0.02,-0.2857142857142857,-0.2857142857142857,0,-0.05194805194805195,-0.023809523809523808,0.07751937984496124,0.06896551724137931,-0.125,-0.028037383177570093,0.2222222222222222,0.13513513513513514,0.2571428571428571,0,-0.14893617021276595,0.09302325581395349,0.03571428571428571,0.25,0.42857142857142855,0.1111111111111111,1.2,0]
    };
  },
  methods: {
    getAllPosts(){
      firebase.auth().currentUser.getIdToken().then((token) => {
        HTTP({
          method:'get',
          url: `users/${this.uid}/notebooks/${this.$route.params.id}.json?auth=${token}`
        })
        .then((notebookObject)=>{
          //Store all posts from db
          for (let i in notebookObject.data.posts) {
            //this merges the notebook ID as another key in the notebookObject
            //then pushes into app state
            this.posts.push(
              Object.assign(notebookObject.data.posts[i], { postID: i })
            );
          }
          //Store all tags from db
          this.tags = notebookObject.data.tags;
          return
        })
        .finally(()=>{
          this.getDateRange()
          this.getSentimentScores()
        })
      })
    },
    getDateRange() {
      this.posts.forEach((post) => {
        this.dateRange.push(post.date);
      });
    },
     getSentimentScores() {
       this.posts.forEach((post) => {
        this.sentimentScores.push(post.sentiment.comparative);
      });
    },
    handleNewPost(newPost) {
      this.posts.push(newPost);
    }
  },
  computed: {
    toggleShow() {
      return true;
    },
    
  },
  watch: {},
  created() {
    //get user id for the session, store in state
    this.uid = localStorage.getItem("UserID");
    localStorage.setItem("NotebookID", this.$route.params.id);
    // console.log(localStorage.getItem("UserID"))
    //get data from db
    this.getAllPosts();
    
  }
};
</script>

<!-- Add "scoped" attribute to limit CSS to this component only -->
<style scoped>
.all-posts {
  display: flex;
  flex-direction: column-reverse; /* easily reverse with column-reverse*/
  align-items: center;
}
</style>
